!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).DrawingMeasure=e()}(this,(function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=i(t);if(e){var o=i(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return a(this,n)}}function c(t,e,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=i(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var h="metric",f=5,g=6,d=3,p=function(){function e(){t(this,e),this._lengthMultiplier=1,this.formatLength=this._formatLengthMetric,this._areaMultiplier=1,this.formatArea=this._formatAreaMetric}return n(e,[{key:"computeOffset",value:function(t,e,n){return google.maps.geometry.spherical.computeOffset(new google.maps.LatLng(t[1],t[0]),e,n)}},{key:"computeLengthBetween",value:function(t,e){return google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(t[1],t[0]),new google.maps.LatLng(e[1],e[0]))*this._lengthMultiplier}},{key:"computePathLength",value:function(t){for(var e=0,n=1;n<t.length;n++)e+=google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(t[n-1][1],t[n-1][0]),new google.maps.LatLng(t[n][1],t[n][0]));return e*this._lengthMultiplier}},{key:"computeArea",value:function(t){return google.maps.geometry.spherical.computeArea(t.map((function(t){return new google.maps.LatLng(t[1],t[0])})))*this._areaMultiplier}},{key:"_formatLengthMetric",value:function(t){var e;return t/1e3>=1?(e="km",t/=1e3):e="m",this._numberToLocale(this._roundUp(t,2))+" "+e}},{key:"_formatAreaMetric",value:function(t){var e;return t/1e6>=1?(e="km²",t/=1e6):e="m²",this._numberToLocale(this._roundUp(t,2))+" "+e}},{key:"_roundUp",value:function(t,e){return Number(Math.round(t+"e"+e)+"e-"+e).toFixed(e)}},{key:"_numberToLocale",value:function(t){return(new Intl.NumberFormat).format(t)}}],[{key:"findTouchPoint",value:function(t,e){var n=((t[1][1]-t[0][1])*(e[0]-t[0][0])-(t[1][0]-t[0][0])*(e[1]-t[0][1]))/(Math.pow(t[1][1]-t[0][1],2)+Math.pow(t[1][0]-t[0][0],2));return[e[0]-n*(t[1][1]-t[0][1]),e[1]+n*(t[1][0]-t[0][0])]}},{key:"findMidPoint",value:function(t){return[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2]}},{key:"transformText",value:function(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e.findMidPoint([t,n]);return 0===(r=t[0]===n[0]?n[1]>t[1]?90:n[1]<t[1]?270:0:180*Math.atan((n[1]-t[1])/(n[0]-t[0]))/Math.PI)&&(o[1]+=i),90===r&&(o[1]-=i),270===r&&(o[0]+=i),"translate(".concat(o[0],", ").concat(o[1],") rotate(").concat(r,")")}}]),e}(),v=function e(){t(this,e),this._helper=new p({unit:h})},_=function(e){r(o,e);var i=s(o);function o(e){var n;return t(this,o),(n=i.call(this))._coordinates=[],n._first=[],e&&(n._first=e.coordinates[0],n._coordinates=e.coordinates),n}return n(o,[{key:"width",get:function(){return this._helper.computeLengthBetween(this._coordinates[0],this._coordinates[1])}},{key:"height",get:function(){return this._helper.computeLengthBetween(this._coordinates[1],this._coordinates[2])}},{key:"nodes",get:function(){if(this.coordinates.length>1){var t=p.findMidPoint([this.coordinates[0],this.coordinates[2]]);return Object.assign([],[t].concat(this.coordinates))}return Object.assign([],this.coordinates)}},{key:"coordinates",get:function(){return Object.assign([],this._coordinates)}},{key:"lines",get:function(){return this.coordinates.length>1?Object.assign([],[[this.coordinates[3],this.coordinates[2]],[this.coordinates[2],this.coordinates[1]]]):Object.assign([],[])}},{key:"area",get:function(){return this.coordinates.length<=1?0:this.width*this.height}},{key:"isValid",get:function(){return this._first&&this._coordinates.length>=4}},{key:"setFirstPoint",value:function(t){this._first=t,this._coordinates[0]=t}},{key:"setEndPoint",value:function(t){var e=this._first[0],n=this._first[1],r=t[0],i=t[1];r>e&&(this._coordinates=i<n?[[e,n],[r,n],[r,i],[e,i]]:[[e,i],[r,i],[r,n],[e,n]]),r<e&&(this._coordinates=i<n?[[r,n],[e,n],[e,i],[r,i]]:[[r,i],[e,i],[e,n],[r,n]])}},{key:"data",value:function(){return{type:"rect",coordinates:this.coordinates}}}]),o}(v),m=function(e){r(o,e);var i=s(o);function o(e,n){var r;if(t(this,o),(r=i.call(this))._projection=e,r._center=[],r._endpoint=[],r._coordinates=[],n){r._center=n.center,r._coordinates[0]=r.center;var a=r._helper.computeOffset(r.center,n.radius,0);r.setEndPoint([a.lng(),a.lat()])}return r}return n(o,[{key:"nodes",get:function(){return this.coordinates}},{key:"coordinates",get:function(){return Object.assign([],this._coordinates)}},{key:"lines",get:function(){return this.coordinates.length>1?Object.assign([],[[this.coordinates[0],this.coordinates[2]]]):Object.assign([],[])}},{key:"center",get:function(){return this._center}},{key:"endpoint",get:function(){return this._endpoint}},{key:"area",get:function(){if(!this.center||!this.endpoint)return 0;var t=this._helper.computeLengthBetween(this.center,this.endpoint);return Math.PI*Math.pow(t,2)}},{key:"svgRadius",get:function(){if(!this.center||!this.endpoint)return 0;var t=this._projection.latLngToSvgPoint(this.center),e=this._projection.latLngToSvgPoint(this.endpoint),n=Math.abs(t[0]-e[0]),r=Math.abs(t[1]-e[1]);return Math.sqrt(Math.pow(n,2)+Math.pow(r,2))}},{key:"isValid",get:function(){return this.center&&this.center.length>0&&this.endpoint&&this.endpoint.length>0}},{key:"setCenter",value:function(t){this._center=t,this._coordinates[0]=t}},{key:"setEndPoint",value:function(t){this._endpoint=t;var e=this._helper.computeLengthBetween(this.center,this.endpoint),n=this._helper.computeOffset(this.center,e,0),r=this._helper.computeOffset(this.center,e,-90),i=this._helper.computeOffset(this.center,e,180),o=this._helper.computeOffset(this.center,e,90);this._coordinates[1]=[n.lng(),n.lat()],this._coordinates[2]=[o.lng(),o.lat()],this._coordinates[3]=[i.lng(),i.lat()],this._coordinates[4]=[r.lng(),r.lat()]}},{key:"data",value:function(){return{type:"circle",center:this.center,radius:this._helper.computeLengthBetween(this.center,this.endpoint)}}}]),o}(v),y={value:()=>{}};function b(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new w(r)}function w(t){this._=t}function x(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function k(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function L(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=y,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}w.prototype=b.prototype={constructor:w,on:function(t,e){var n,r=this._,i=x(t+"",r),o=-1,a=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=i[o]).type)r[n]=L(r[n],t.name,e);else if(null==e)for(n in r)r[n]=L(r[n],t.name,null);return this}for(;++o<a;)if((n=(t=i[o]).type)&&(n=k(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new w(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};var P="http://www.w3.org/1999/xhtml",C={svg:"http://www.w3.org/2000/svg",xhtml:P,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function j(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),C.hasOwnProperty(e)?{space:C[e],local:t}:t}function T(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===P&&e.documentElement.namespaceURI===P?e.createElement(t):e.createElementNS(n,t)}}function O(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function S(t){var e=j(t);return(e.local?O:T)(e)}function E(){}function M(t){return null==t?E:function(){return this.querySelector(t)}}function A(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function U(){return[]}function N(t){return function(e){return e.matches(t)}}var D=Array.prototype.find;function G(){return this.firstElementChild}var R=Array.prototype.filter;function I(){return this.children}function B(t){return new Array(t.length)}function q(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function V(t){return function(){return t}}function z(t,e,n,r,i,o){for(var a,s=0,c=e.length,u=o.length;s<u;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new q(t,o[s]);for(;s<c;++s)(a=e[s])&&(i[s]=a)}function F(t,e,n,r,i,o,a){var s,c,u,l=new Map,h=e.length,f=o.length,g=new Array(h);for(s=0;s<h;++s)(c=e[s])&&(g[s]=u=a.call(c,c.__data__,s,e)+"",l.has(u)?i[s]=c:l.set(u,c));for(s=0;s<f;++s)u=a.call(t,o[s],s,o)+"",(c=l.get(u))?(r[s]=c,c.__data__=o[s],l.delete(u)):n[s]=new q(t,o[s]);for(s=0;s<h;++s)(c=e[s])&&l.get(g[s])===c&&(i[s]=c)}function H(t){return t.__data__}function X(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Y(t){return function(){this.removeAttribute(t)}}function K(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Z(t,e){return function(){this.setAttribute(t,e)}}function $(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function J(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function Q(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function W(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function tt(t){return function(){this.style.removeProperty(t)}}function et(t,e,n){return function(){this.style.setProperty(t,e,n)}}function nt(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function rt(t,e){return t.style.getPropertyValue(e)||W(t).getComputedStyle(t,null).getPropertyValue(e)}function it(t){return function(){delete this[t]}}function ot(t,e){return function(){this[t]=e}}function at(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function st(t){return t.trim().split(/^|\s+/)}function ct(t){return t.classList||new ut(t)}function ut(t){this._node=t,this._names=st(t.getAttribute("class")||"")}function lt(t,e){for(var n=ct(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function ht(t,e){for(var n=ct(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function ft(t){return function(){lt(this,t)}}function gt(t){return function(){ht(this,t)}}function dt(t,e){return function(){(e.apply(this,arguments)?lt:ht)(this,t)}}function pt(){this.textContent=""}function vt(t){return function(){this.textContent=t}}function _t(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function mt(){this.innerHTML=""}function yt(t){return function(){this.innerHTML=t}}function bt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function wt(){this.nextSibling&&this.parentNode.appendChild(this)}function xt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function kt(){return null}function Lt(){var t=this.parentNode;t&&t.removeChild(this)}function Pt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ct(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function jt(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function Tt(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function Ot(t,e,n){return function(){var r,i=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var a=0,s=i.length;a<s;++a)if((r=i[a]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),void(r.value=e);this.addEventListener(t.type,o,n),r={type:t.type,name:t.name,value:e,listener:o,options:n},i?i.push(r):this.__on=[r]}}function St(t,e,n){var r=W(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function Et(t,e){return function(){return St(this,t,e)}}function Mt(t,e){return function(){return St(this,t,e.apply(this,arguments))}}q.prototype={constructor:q,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},ut.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var At=[null];function Ut(t,e){this._groups=t,this._parents=e}function Nt(t){return"string"==typeof t?new Ut([[document.querySelector(t)]],[document.documentElement]):new Ut([[t]],At)}function Dt(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}function Gt(t){t.stopImmediatePropagation()}function Rt(t){t.preventDefault(),t.stopImmediatePropagation()}Ut.prototype={constructor:Ut,select:function(t){"function"!=typeof t&&(t=M(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a,s=e[i],c=s.length,u=r[i]=new Array(c),l=0;l<c;++l)(o=s[l])&&(a=t.call(o,o.__data__,l,s))&&("__data__"in o&&(a.__data__=o.__data__),u[l]=a);return new Ut(r,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);return null==e?[]:A(e)}}(t):function(t){return null==t?U:function(){return this.querySelectorAll(t)}}(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a,s=e[o],c=s.length,u=0;u<c;++u)(a=s[u])&&(r.push(t.call(a,a.__data__,u,s)),i.push(a));return new Ut(r,i)},selectChild:function(t){return this.select(null==t?G:function(t){return function(){return D.call(this.children,t)}}("function"==typeof t?t:N(t)))},selectChildren:function(t){return this.selectAll(null==t?I:function(t){return function(){return R.call(this.children,t)}}("function"==typeof t?t:N(t)))},filter:function(t){"function"!=typeof t&&(t=function(t){return function(){return this.matches(t)}}(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],s=a.length,c=r[i]=[],u=0;u<s;++u)(o=a[u])&&t.call(o,o.__data__,u,a)&&c.push(o);return new Ut(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,H);var n=e?F:z,r=this._parents,i=this._groups;"function"!=typeof t&&(t=V(t));for(var o=i.length,a=new Array(o),s=new Array(o),c=new Array(o),u=0;u<o;++u){var l=r[u],h=i[u],f=h.length,g=A(t.call(l,l&&l.__data__,u,r)),d=g.length,p=s[u]=new Array(d),v=a[u]=new Array(d),_=c[u]=new Array(f);n(l,h,p,v,_,g,e);for(var m,y,b=0,w=0;b<d;++b)if(m=p[b]){for(b>=w&&(w=b+1);!(y=v[w])&&++w<d;);m._next=y||null}}return(a=new Ut(a,r))._enter=s,a._exit=c,a},enter:function(){return new Ut(this._enter||this._groups.map(B),this._parents)},exit:function(){return new Ut(this._exit||this._groups.map(B),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,o=this.exit();return r="function"==typeof t?t(r):r.append(t+""),null!=e&&(i=e(i)),null==n?o.remove():n(o),r&&i?r.merge(i).order():i},merge:function(t){if(!(t instanceof Ut))throw new Error("invalid merge");for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),s=0;s<o;++s)for(var c,u=e[s],l=n[s],h=u.length,f=a[s]=new Array(h),g=0;g<h;++g)(c=u[g]||l[g])&&(f[g]=c);for(;s<r;++s)a[s]=e[s];return new Ut(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=X);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,s=n[o],c=s.length,u=i[o]=new Array(c),l=0;l<c;++l)(a=s[l])&&(u[l]=a);u.sort(e)}return new Ut(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],a=0,s=o.length;a<s;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},attr:function(t,e){var n=j(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?K:Y:"function"==typeof e?n.local?Q:J:n.local?$:Z)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?tt:"function"==typeof e?nt:et)(t,e,null==n?"":n)):rt(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?it:"function"==typeof e?at:ot)(t,e)):this.node()[t]},classed:function(t,e){var n=st(t+"");if(arguments.length<2){for(var r=ct(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?dt:e?ft:gt)(n,e))},text:function(t){return arguments.length?this.each(null==t?pt:("function"==typeof t?_t:vt)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?mt:("function"==typeof t?bt:yt)(t)):this.node().innerHTML},raise:function(){return this.each(wt)},lower:function(){return this.each(xt)},append:function(t){var e="function"==typeof t?t:S(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:S(t),r=null==e?kt:"function"==typeof e?e:M(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Lt)},clone:function(t){return this.select(t?Ct:Pt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,o=jt(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?Ot:Tt,r=0;r<a;++r)this.each(s(o[r],e,n));return this}var s=this.node().__on;if(s)for(var c,u=0,l=s.length;u<l;++u)for(r=0,c=s[u];r<a;++r)if((i=o[r]).type===c.type&&i.name===c.name)return c.value},dispatch:function(t,e){return this.each(("function"==typeof e?Mt:Et)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],o=0,a=i.length;o<a;++o)(r=i[o])&&(yield r)}};var It=t=>()=>t;function Bt(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:o,x:a,y:s,dx:c,dy:u,dispatch:l}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:l}})}function qt(t){return!t.ctrlKey&&!t.button}function Vt(){return this.parentNode}function zt(t,e){return null==e?{x:t.x,y:t.y}:e}function Ft(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ht(){var t,e,n,r,i=qt,o=Vt,a=zt,s=Ft,c={},u=b("start","drag","end"),l=0,h=0;function f(t){t.on("mousedown.drag",g).filter(s).on("touchstart.drag",v).on("touchmove.drag",_).on("touchend.drag touchcancel.drag",m).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(a,s){if(!r&&i.call(this,a,s)){var c=y(this,o.call(this,a,s),a,s,"mouse");c&&(Nt(a.view).on("mousemove.drag",d,!0).on("mouseup.drag",p,!0),function(t){var e=t.document.documentElement,n=Nt(t).on("dragstart.drag",Rt,!0);"onselectstart"in e?n.on("selectstart.drag",Rt,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}(a.view),Gt(a),n=!1,t=a.clientX,e=a.clientY,c("start",a))}}function d(r){if(Rt(r),!n){var i=r.clientX-t,o=r.clientY-e;n=i*i+o*o>h}c.mouse("drag",r)}function p(t){Nt(t.view).on("mousemove.drag mouseup.drag",null),function(t,e){var n=t.document.documentElement,r=Nt(t).on("dragstart.drag",null);e&&(r.on("click.drag",Rt,!0),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}(t.view,n),Rt(t),c.mouse("end",t)}function v(t,e){if(i.call(this,t,e)){var n,r,a=t.changedTouches,s=o.call(this,t,e),c=a.length;for(n=0;n<c;++n)(r=y(this,s,t,e,a[n].identifier,a[n]))&&(Gt(t),r("start",t,a[n]))}}function _(t){var e,n,r=t.changedTouches,i=r.length;for(e=0;e<i;++e)(n=c[r[e].identifier])&&(Rt(t),n("drag",t,r[e]))}function m(t){var e,n,i=t.changedTouches,o=i.length;for(r&&clearTimeout(r),r=setTimeout((function(){r=null}),500),e=0;e<o;++e)(n=c[i[e].identifier])&&(Gt(t),n("end",t,i[e]))}function y(t,e,n,r,i,o){var s,h,g,d=u.copy(),p=Dt(o||n,e);if(null!=(g=a.call(t,new Bt("beforestart",{sourceEvent:n,target:f,identifier:i,active:l,x:p[0],y:p[1],dx:0,dy:0,dispatch:d}),r)))return s=g.x-p[0]||0,h=g.y-p[1]||0,function n(o,a,u){var v,_=p;switch(o){case"start":c[i]=n,v=l++;break;case"end":delete c[i],--l;case"drag":p=Dt(u||a,e),v=l}d.call(o,t,new Bt(o,{sourceEvent:a,subject:g,target:f,identifier:i,active:v,x:p[0]+s,y:p[1]+h,dx:p[0]-_[0],dy:p[1]-_[1],dispatch:d}),r)}}return f.filter=function(t){return arguments.length?(i="function"==typeof t?t:It(!!t),f):i},f.container=function(t){return arguments.length?(o="function"==typeof t?t:It(t),f):o},f.subject=function(t){return arguments.length?(a="function"==typeof t?t:It(t),f):a},f.touchable=function(t){return arguments.length?(s="function"==typeof t?t:It(!!t),f):s},f.on=function(){var t=u.on.apply(u,arguments);return t===u?f:t},f.clickDistance=function(t){return arguments.length?(h=(t=+t)*t,f):Math.sqrt(h)},f}Bt.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var Xt=function(){function e(n,r,i){t(this,e),this._defaultOptions={offsetRate:8e3},this._options=Object.assign({},this._defaultOptions,i||{}),this._container=n,this._projection=r}return n(e,[{key:"latLngToSvgPoint",value:function(t){var e=this._options.offsetRate/2,n=new google.maps.LatLng(t[1],t[0]),r=this._projection.fromLatLngToDivPixel(n);return[r.x+e,r.y+e]}},{key:"svgPointToLatLng",value:function(t){var e=this._options.offsetRate/2,n=new google.maps.Point(t[0]-e,t[1]-e),r=this._projection.fromDivPixelToLatLng(n);return[r.lng(),r.lat()]}},{key:"svgPointToContainerPoint",value:function(t){var e=this.svgPointToLatLng(t);return this._projection.fromLatLngToContainerPixel(new google.maps.LatLng(e[1],e[0]))}},{key:"latLngToContainerPoint",value:function(t){return this._projection.fromLatLngToContainerPixel(new google.maps.LatLng(t[1],t[0]))}}]),e}(),Yt=function(){function e(n){t(this,e),this._map=n,this._map.setClickableIcons(!1),this._events=new Map,this._data=new Map,this._drawing=null,this._helper=new p,this._init()}return n(e,[{key:"curGeometry",get:function(){return this._data.get(this._curGeomIndex)}},{key:"curNodes",get:function(){return Object.assign([],this.geometry()?this.geometry().nodes:[])}},{key:"addListener",value:function(t,e){this._events.set(t,e)}},{key:"removeListener",value:function(t){this._events.delete(t)}},{key:"geometry",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return 0===t?this.curGeometry:this._data.get(t)}},{key:"geometries",value:function(){return this._data}},{key:"addGeometry",value:function(t){var e=Array.from(this._data.keys());this._curGeomIndex=(0===e.length?0:e.pop())+1,this._data.set(this._curGeomIndex,t)}},{key:"removeGeometry",value:function(t){this._data.delete(t),this._curGeomIndex=0}},{key:"_init",value:function(){this._containerDiv=this._map.getDiv().querySelector("div:first-child"),this._initOverlay()}},{key:"_initOverlay",value:function(){this._setOverlay(),this._initCompleted=!1}},{key:"_setOverlay",value:function(){this._overlay=new google.maps.OverlayView,this._overlay.onAdd=this._onAddOverlay.bind(this),this._overlay.draw=this._onDrawOverlay.bind(this),this._overlay.setMap(this._map)}},{key:"_onAddOverlay",value:function(){this._initCompleted=!0,this._projection=this._overlay.getProjection(),this._projectionUtils=new Xt(this._containerDiv,this._projection),this._svgOverlay=Nt(this._overlay.getPanes().overlayMouseTarget).append("div").attr("id","drawing-tool-container").append("svg").attr("class","drawing-tool-svg-overlay"),this._svgObjs=this._svgOverlay.append("g").attr("class","base"),this._svgObjs.selectAll("rect").data([]),this._svgObjs.selectAll("circle").data([]),this._svgObjs.selectAll("line").data([]),this._nodeCircles=this._svgOverlay.append("g").attr("class","node-circle"),this._touchCircles=this._svgOverlay.append("g").attr("class","touch-circle"),this._segmentText=this._svgOverlay.append("g").attr("class","segment-text"),this._nodeText=this._svgOverlay.append("g").attr("class","node-text")}},{key:"_onDrawOverlay",value:function(){this._updateNodeCircles(),this._updateNodeTouchCircles()}},{key:"_updateNodeCircles",value:function(){var t=this;if(this._curGeomIndex<=0)this._nodeCircles.selectAll("circle").remove();else{var e=this;this._nodeCircles.selectAll("circle").data(this.curNodes).join("circle").datum((function(t,e){return[t,e]})).attr("class",(function(t){return 0===u(t,2)[1]?"cover-circle head-circle":"cover-circle"})).attr("r",f).attr("cx",(function(e){var n=u(e,1)[0];return t._projectionUtils.latLngToSvgPoint(n)[0]})).attr("cy",(function(e){var n=u(e,1)[0];return t._projectionUtils.latLngToSvgPoint(n)[1]})).on("mouseover",(function(t,n){var r=u(n,2),i=r[0],o=r[1];e._onOverCircle(i,o,this)})).on("mouseout",(function(t,n){var r=u(n,2),i=r[0],o=r[1];e._onOutCircle(i,o,this)})).on("mousedown",(function(){})).enter().append("circle").attr("class","cover-circle").attr("r",f).attr("cx",(function(e){var n=u(e,1)[0];return t._projectionUtils.latLngToSvgPoint(n)[0]})).attr("cy",(function(e){var n=u(e,1)[0];return t._projectionUtils.latLngToSvgPoint(n)[1]})).on("mouseover",(function(t,n){var r=u(n,2),i=r[0],o=r[1];e._onOverCircle(i,o,this)})).on("mouseout",(function(t,n){var r=u(n,2),i=r[0],o=r[1];e._onOutCircle(i,o,this)})).on("mousedown",(function(){})),this._nodeCircles.selectAll(".removed-circle").remove()}}},{key:"_updateNodeTouchCircles",value:function(){var t=this;if(this._curGeomIndex<=0||this._drawing)this._touchCircles.selectAll("circle").remove();else{var e=this;this._touchCircles.selectAll("circle").data(this.curNodes).join("circle").datum((function(t,e){return[t,e]})).attr("class",(function(t){return 0===u(t,2)[1]?"touch-circle head-circle":"touch-circle"})).attr("r",f).attr("cx",(function(e){var n=u(e,1)[0];return t._projectionUtils.latLngToSvgPoint(n)[0]})).attr("cy",(function(e){var n=u(e,1)[0];return t._projectionUtils.latLngToSvgPoint(n)[1]})).on("mouseover",(function(t,n){var r=u(n,2),i=r[0],o=r[1];e._onOverCircle(i,o,this)})).on("mouseout",(function(t,n){var r=u(n,2),i=r[0],o=r[1];e._onOutCircle(i,o,this)})).on("touchstart",(function(t,n){var r=u(n,2),i=r[0],o=r[1];t.preventDefault(),e._onOverCircle(i,o,this)})).on("touchend",(function(t,n){var r=u(n,2),i=r[0],o=r[1];t.preventDefault(),e._onOutCircle(i,o,this)})).call(this._onDragCircle()).enter().append("circle").attr("class",(function(t){return 0===u(t,2)[1]?"touch-circle head-circle":"touch-circle"})).attr("r",f).attr("cx",(function(e){var n=u(e,1)[0];return t._projectionUtils.latLngToSvgPoint(n)[0]})).attr("cy",(function(e){var n=u(e,1)[0];return t._projectionUtils.latLngToSvgPoint(n)[1]})).on("mouseover",(function(t,n){var r=u(n,2),i=r[0],o=r[1];e._onOverCircle(i,o,this)})).on("mouseout",(function(t,n){var r=u(n,2),i=r[0],o=r[1];e._onOutCircle(i,o,this)})).on("touchstart",(function(t,n){var r=u(n,2),i=r[0],o=r[1];t.preventDefault(),e._onOverCircle(i,o,this)})).on("touchend",(function(t,n){var r=u(n,2),i=r[0],o=r[1];t.preventDefault(),e._onOutCircle(i,o,this)})).call(this._onDragCircle())}}},{key:"_mapClickFunc",value:function(){this._overlay.draw(),this._dragged=!1}},{key:"_draw",value:function(){var t=this;this._svgOverlayEvent&&(this._svgOverlay.on("click",null),this._svgOverlayEvent=null),this._mapRectMouseMoveEvent&&this._mapRectMouseMoveEvent.remove(),this._mapCircleMouseMoveEvent&&this._mapCircleMouseMoveEvent.remove(),this._mapPolygonClickEvent&&this._mapPolygonClickEvent.remove(),this._mapClickEvent&&this._mapClickEvent.remove(),this._mapClickEvent=this._map.addListener("click",(function(e){return t._mapClickFunc(e)})),this._map.setOptions({dragableCursor:"default"})}},{key:"_onOverCircle",value:function(t,e,n){if(!this._dragging){var r=Nt(n);r.classed("base")||(r=this._nodeCircles.select("circle:nth-child(".concat(e+1,")"))),r.attr("r",g)}}},{key:"_onOutCircle",value:function(t,e,n){var r=Nt(n);r.classed("base")||(r=this._nodeCircles.select("circle:nth-child(".concat(e+1,")"))),r.attr("r",f)}},{key:"_onDragCircle",value:function(){var t=this,e=!1,n=Ht();return n.on("drag",(function(n,r){var i=u(r,2)[1];e=!0,t._dragging=!0,t._updateCirclePosition(i,n),t.onCircleDragging(n,i)})),n.on("start",(function(e){e.sourceEvent.stopPropagation(),Nt(this).raise().attr("r",g),t._disableMapScroll(),t.onCircleDragStart(e)})),n.on("end",(function(n,r){var i=u(r,2)[1];t._enableMapScroll(),e?t.onCircleDragEnd(n,i):i>0?Nt(this).classed("removed-circle",!0):t._dragged=!0,e=!1,t._dragging=!1,t._overlay.draw()})),n}},{key:"onCircleDragging",value:function(){}},{key:"onCircleDragStart",value:function(){}},{key:"onCircleDragEnd",value:function(){}},{key:"_disableMapScroll",value:function(){this._zoomControl=!!document.querySelector('button[aria-label="Zoom in"]'),this._map.setOptions({scrollwheel:!1,gestureHandling:"none",zoomControl:!1})}},{key:"_enableMapScroll",value:function(){this._map.setOptions({scrollwheel:!0,gestureHandling:"auto",zoomControl:this._zoomControl})}},{key:"_updateCirclePosition",value:function(t,e){this._nodeCircles.select("circle:nth-child(".concat(t+1,")")).attr("cx",e.x).attr("cy",e.y)}}]),e}(),Kt=[],Zt=[];!function(t,e){if(t&&"undefined"!=typeof document){var n,r=!0===e.prepend?"prepend":"append",i=!0===e.singleTag,o="string"==typeof e.container?document.querySelector(e.container):document.getElementsByTagName("head")[0];if(i){var a=Kt.indexOf(o);-1===a&&(a=Kt.push(o)-1,Zt[a]={}),n=Zt[a]&&Zt[a][r]?Zt[a][r]:Zt[a][r]=s()}else n=s();65279===t.charCodeAt(0)&&(t=t.substring(1)),n.styleSheet?n.styleSheet.cssText+=t:n.appendChild(document.createTextNode(t))}function s(){var t=document.createElement("style");if(t.setAttribute("type","text/css"),e.attributes)for(var n=Object.keys(e.attributes),i=0;i<n.length;i++)t.setAttribute(n[i],e.attributes[n[i]]);var a="prepend"===r?"afterbegin":"beforeend";return o.insertAdjacentElement(a,t),t}}(".drawing-tool-svg-overlay {\n  position: absolute;\n  top: -4000px;\n  left: -4000px;\n  width: 8000px;\n  height: 8000px; }\n\n.cover-circle {\n  fill: white;\n  stroke: black;\n  stroke-width: 2px; }\n\n.touch-circle {\n  fill: transparent;\n  cursor: pointer; }\n\n.grey-circle {\n  fill: #fcfcfc;\n  stroke: #646464;\n  stroke-width: 2px;\n  pointer-events: none; }\n\n.base-line {\n  fill: rgba(170, 218, 255, 0.3);\n  stroke: black;\n  stroke-width: 2px;\n  stroke-dasharray: 2; }\n\n.none {\n  display: none; }\n\n.segment-measure-text {\n  pointer-events: none;\n  stroke: black;\n  text-shadow: -2.4px -2.4px rgba(255, 255, 255, 0.4), -2.4px 2.4px rgba(255, 255, 255, 0.4), 2.4px 2.4px rgba(255, 255, 255, 0.4), 2.4px -2.4px rgba(255, 255, 255, 0.4), -2.4px 0 rgba(255, 255, 255, 0.4), 0 2.4px rgba(255, 255, 255, 0.4), 2.4px 0 rgba(255, 255, 255, 0.4), 0 -2.4px rgba(255, 255, 255, 0.4); }\n\n.node-measure-text {\n  stroke: black;\n  text-shadow: -2.4px -2.4px rgba(255, 255, 255, 0.4), -2.4px 2.4px rgba(255, 255, 255, 0.4), 2.4px 2.4px rgba(255, 255, 255, 0.4), 2.4px -2.4px rgba(255, 255, 255, 0.4), -2.4px 0 rgba(255, 255, 255, 0.4), 0 2.4px rgba(255, 255, 255, 0.4), 2.4px 0 rgba(255, 255, 255, 0.4), 0 -2.4px rgba(255, 255, 255, 0.4);\n  pointer-events: none; }\n  .node-measure-text.head-text {\n    visibility: hidden; }\n",{});var $t="draw_end",Jt=function(e){r(o,e);var i=s(o);function o(e){var n;return t(this,o),(n=i.call(this))._closed=!1,n._coordinates=[],e&&(n._closed=!0,n._coordinates=e.coordinates),n}return n(o,[{key:"nodes",get:function(){var t=Object.assign([],this.coordinates);return this.isClosed&&t.push(this.center),t}},{key:"coordinates",get:function(){return Object.assign([],this._coordinates)}},{key:"lines",get:function(){var t=[],e=this.coordinates;if(this.isClosed&&e.push(e[0]),e.length>1)for(var n=1;n<e.length;n++)t.push([e[n-1],e[n]]);return t}},{key:"isClosed",get:function(){return!0===this._closed}},{key:"area",get:function(){return this._helper.computeArea(this.nodes)}},{key:"center",get:function(){var t=this.coordinates[0][0],e=this.coordinates[0][0],n=this.coordinates[0][1],r=this.coordinates[0][1];return this.coordinates.forEach((function(i){t>i[0]&&(t=i[0]),e<i[0]&&(e=i[0]),n>i[1]&&(n=i[1]),r<i[1]&&(r=i[1])})),[t+(e-t)/2,n+(r-n)/2]}},{key:"isValid",get:function(){return!0===this._closed}},{key:"addPoint",value:function(t){this._coordinates.push(t)}},{key:"updatePoint",value:function(t,e){this._coordinates[t]=e}},{key:"updatePoints",value:function(t){this._coordinates=t}},{key:"setClosed",value:function(){this._closed=!0}},{key:"data",value:function(){return{type:"polygon",coordinates:this.coordinates}}}]),o}(v),Qt=d;return function(e){r(a,e);var o=s(a);function a(){return t(this,a),o.apply(this,arguments)}return n(a,[{key:"rects",get:function(){var t=[];return this._data.forEach((function(e,n){e instanceof _&&t.push({id:n,geom:e})})),t}},{key:"circles",get:function(){var t=[];return this._data.forEach((function(e,n){e instanceof m&&t.push({id:n,geom:e})})),t}},{key:"polygons",get:function(){var t=[];return this._data.forEach((function(e,n){e instanceof Jt&&t.push({id:n,geom:e})})),t}},{key:"area",get:function(){var t=0;return this.geometries().forEach((function(e){t+=e.area})),t}},{key:"_init",value:function(){var t=this;c(i(a.prototype),"_init",this).call(this),this._containerDiv.addEventListener("keydown",(function(e){switch(e.code.toUpperCase()){case"DELETE":var n=t._curGeomIndex;n&&t.removeGeometry(n)}}))}},{key:"_onDrawOverlay",value:function(){c(i(a.prototype),"_onDrawOverlay",this).call(this),this._updateRectangle(),this._updateCircle(),this._updatePolygon(),this._dispatchDrawingEvent()}},{key:"_dispatchDrawingEvent",value:function(){this._drawing||"function"==typeof this._events.get($t)&&this._events.get($t)(this._results())}},{key:"_results",value:function(){var t=this.area;return{area:t,areaText:this._helper.formatArea(t)}}},{key:"setData",value:function(t){var e=this;t&&(t.forEach((function(t){switch(t.type){case"circle":e.addGeometry(new m(e._projectionUtils,t));break;case"rect":e.addGeometry(new _(t));break;case"polygon":e.addGeometry(new Jt(t))}e.drawEnd(!0)})),this._curGeomIndex=0,this._overlay.draw(),this._dragged=!1)}},{key:"data",value:function(){var t=[];return this.geometries().forEach((function(e){t.push(e.data())})),t}},{key:"removeGeometry",value:function(t){c(i(a.prototype),"removeGeometry",this).call(this,t);var e="rect[id=rect-".concat(t,"], circle[id=circle-").concat(t,"], line[id=line-").concat(t,"],");e+="g[id=g-rect-".concat(t,"], g[id=g-circle-").concat(t,"],"),e+="polygon[id=polygon-".concat(t,"], g[id=gpolygon-").concat(t,"], g[id=g-polygon-").concat(t,"]"),this._svgOverlay.selectAll(e).remove(),this._overlay.draw()}},{key:"_mapClickFunc",value:function(t){var e=this;if(!this._dragged&&0===this._touchCircles.selectAll('circle[r="'.concat(g,'"]')).size()){var n=[t.latLng.lng(),t.latLng.lat()];this.geometry()instanceof _&&(this.geometry().setFirstPoint(n),this._mapClickEvent.remove(),this._mapRectMouseMoveEvent=this._map.addListener("mousemove",(function(t){e.geometry().setEndPoint([t.latLng.lng(),t.latLng.lat()]),e._overlay.draw(),e._dragged=!1})),this._mapClickEvent=this._map.addListener("click",(function(t){e.geometry().setEndPoint([t.latLng.lng(),t.latLng.lat()]),e._mapClickEvent.remove(),e._mapRectMouseMoveEvent.remove(),e.drawEnd()}))),this.geometry()instanceof m&&(this.geometry().setCenter(n),this._mapClickEvent.remove(),this._mapCircleMouseMoveEvent=this._map.addListener("mousemove",(function(t){e.geometry().setEndPoint([t.latLng.lng(),t.latLng.lat()]),e._overlay.draw(),e._dragged=!1})),this._mapClickEvent=this._map.addListener("click",(function(t){e.geometry().setEndPoint([t.latLng.lng(),t.latLng.lat()]),e._mapClickEvent.remove(),e._mapCircleMouseMoveEvent.remove(),e.drawEnd()}))),this.geometry()instanceof Jt&&(this.geometry().addPoint(n),this._overlay.draw(),this._mapPolygonClickEvent=this._map.addListener("rightclick",(function(){e.geometry().setClosed(),e._mapClickEvent.remove(),e._mapPolygonClickEvent.remove(),e.drawEnd()})))}c(i(a.prototype),"_mapClickFunc",this).call(this,t)}},{key:"onCircleDragging",value:function(t,e){c(i(a.prototype),"onCircleDragging",this).call(this,t,e),this.geometry()instanceof _&&(this._updateRectPosition(e,t),this._updateRectNode(e,t),this._updateNodeCircles(),this._updateSegmentTextRect()),this.geometry()instanceof m&&(this._updateCirclePosition(e,t),this._updateCircleNode(e,t),this._updateNodeCircles(),this._updateSegmentTextCircle()),this.geometry()instanceof Jt&&(this._updatePolygonPosition(e,t),this._updatePolygonNode(e,t),this._updateNodeCircles(),this._updateSegmentTextPolygon())}},{key:"drawPolygon",value:function(){var t=this;"polygon"!==this._drawing&&(this.geometries().forEach((function(e,n){e.isValid||t.removeGeometry(n)})),this.addGeometry(new Jt),this._draw(),this._drawing="polygon")}},{key:"_updatePolygon",value:function(){var t=this,e=this._svgObjs.selectAll("polygon[id^=polygon-]").data(this.polygons).attr("class",(function(t){return"base-line".concat(t.geom.isClosed?"":" none")})).attr("points",(function(e){var n=e.geom.coordinates,r=[];return n.forEach((function(e){var n=t._projectionUtils.latLngToSvgPoint(e);r.push("".concat(n[0],",").concat(n[1]))})),r.join(" ")}));this.geometry()instanceof Jt&&e.enter().append("polygon").attr("id",(function(t){return"polygon-".concat(t.id)})).attr("class",(function(e){return"base-line".concat(t.geometry(e.id).isClosed?"":" none")})).attr("points",(function(e){var n=t.geometry(e.id).coordinates,r=[];return n.forEach((function(e){var n=t._projectionUtils.latLngToSvgPoint(e);r.push("".concat(n[0],",").concat(n[1]))})),r.join(" ")}));var n=this._svgObjs.selectAll("g[id^=gpolygon-]").data(this.polygons).attr("id",(function(t){return"gpolygon-".concat(t.id)})).attr("class",(function(e){return"".concat(t.geometry(e.id).isClosed?"none":"")}));n.enter().append("g").attr("id",(function(t){return"gpolygon-".concat(t.id)})).attr("class",(function(e){return"".concat(t.geometry(e.id).isClosed?"none":"")})),n.selectAll("line").data((function(e){return t.geometry(e.id).lines})).attr("class","base-line").attr("x1",(function(e){return t._projectionUtils.latLngToSvgPoint(e[0])[0]})).attr("y1",(function(e){return t._projectionUtils.latLngToSvgPoint(e[0])[1]})).attr("x2",(function(e){return t._projectionUtils.latLngToSvgPoint(e[1])[0]})).attr("y2",(function(e){return t._projectionUtils.latLngToSvgPoint(e[1])[1]})).enter().append("line").attr("class","base-line").attr("x1",(function(e){return t._projectionUtils.latLngToSvgPoint(e[0])[0]})).attr("y1",(function(e){return t._projectionUtils.latLngToSvgPoint(e[0])[1]})).attr("x2",(function(e){return t._projectionUtils.latLngToSvgPoint(e[1])[0]})).attr("y2",(function(e){return t._projectionUtils.latLngToSvgPoint(e[1])[1]})),this._updateSegmentTextPolygon()}},{key:"_updateSegmentTextPolygon",value:function(){var t=this,e=this._segmentText.selectAll("g[id^=g-polygon-]").data(this.polygons);e.enter().append("g").attr("id",(function(t){return"g-polygon-".concat(t.id)}));var n=e.selectAll("text").data((function(e){return t.geometry(e.id).lines})).attr("class","segment-measure-text").attr("text-anchor","middle").attr("dominant-baseline","text-before-edge").attr("transform",(function(e){var n=t._projectionUtils.latLngToSvgPoint(e[0]),r=t._projectionUtils.latLngToSvgPoint(e[1]);return p.transformText(n,r,Qt)})).text((function(e){return t._helper.formatLength(t._helper.computeLengthBetween(e[0],e[1]))}));n.enter().append("text").attr("class","segment-measure-text").attr("text-anchor","middle").attr("dominant-baseline","text-before-edge").attr("transform",(function(e){var n=t._projectionUtils.latLngToSvgPoint(e[0]),r=t._projectionUtils.latLngToSvgPoint(e[1]);return p.transformText(n,r,Qt)})).text((function(e){return t._helper.formatLength(t._helper.computeLengthBetween(e[0],e[1]))})),n.exit().remove()}},{key:"_updatePolygonPosition",value:function(t,e){var n=this._svgObjs.select("polygon[id=polygon-".concat(this._curGeomIndex,"]"));if(0!==n.size()){var r=n.attr("points").split(" ").map((function(t){return t.split(",").map((function(t){return Number(t)}))}));if(t===r.length){var i=this._projectionUtils.latLngToSvgPoint(this.geometry().center);r=r.map((function(t){return t[0]+=e.x-i[0],t[1]+=e.y-i[1],t}))}else r[t]=[e.x,e.y];n.attr("points",(function(){return r.map((function(t){return t.join(",")})).join(" ")}))}}},{key:"_updatePolygonNode",value:function(t,e){var n=this._projectionUtils.svgPointToLatLng([e.x,e.y]);if(t===this.geometry().coordinates.length){var r=this.geometry().center,i=this.geometry().coordinates.map((function(t){return t[0]+=n[0]-r[0],t[1]+=n[1]-r[1],t}));this.geometry().updatePoints(i)}else this.geometry().updatePoint(t,n)}},{key:"drawCircle",value:function(){var t=this;"circle"!==this._drawing&&(this.geometries().forEach((function(e,n){e.isValid||t.removeGeometry(n)})),this.addGeometry(new m(this._projectionUtils)),this._draw(),this._drawing="circle")}},{key:"_updateCircle",value:function(){var t=this,e=this._svgObjs.selectAll("circle").data(this.circles).attr("class","base-line").attr("cx",(function(e){return t._projectionUtils.latLngToSvgPoint(e.geom.center)[0]})).attr("cy",(function(e){return t._projectionUtils.latLngToSvgPoint(e.geom.center)[1]})).attr("r",(function(e){var n=e.geom.center,r=e.geom.endpoint,i=0;if(n.length&&r.length){var o=t._projectionUtils.latLngToSvgPoint(n),a=t._projectionUtils.latLngToSvgPoint(r),s=Math.abs(o[0]-a[0]),c=Math.abs(o[1]-a[1]);i=Math.sqrt(Math.pow(s,2)+Math.pow(c,2))}return i||1}));if(this.geometry()instanceof m){var n=this.geometry().center,r=this.geometry().endpoint;if(n.length&&r.length){var i=this._projectionUtils.latLngToSvgPoint(n),o=this._projectionUtils.latLngToSvgPoint(r),a=Math.abs(i[0]-o[0]),s=Math.abs(i[1]-o[1]),c=Math.sqrt(Math.pow(a,2)+Math.pow(s,2));e.enter().append("circle").attr("id","circle-".concat(this._curGeomIndex)).attr("class","base-line").attr("cx",i[0]).attr("cy",i[1]).attr("r",c||1)}}this._updateSegmentTextCircle()}},{key:"_updateSegmentTextCircle",value:function(){var t=this,e=this._segmentText.selectAll("g[id^=g-circle-]").data(this.circles);e.enter().append("g").attr("id",(function(t){return"g-circle-".concat(t.id)}));var n=e.selectAll("text").data((function(e){return t.geometry(e.id).lines})).attr("class","segment-measure-text").attr("text-anchor","middle").attr("dominant-baseline","text-before-edge").attr("transform",(function(e){var n=t._projectionUtils.latLngToSvgPoint(e[0]),r=t._projectionUtils.latLngToSvgPoint(e[1]);return p.transformText(n,r,Qt)})).text((function(e){return t._helper.formatLength(t._helper.computeLengthBetween(e[0],e[1]))}));n.enter().append("text").attr("class","segment-measure-text").attr("text-anchor","middle").attr("dominant-baseline","text-before-edge").attr("transform",(function(e){var n=t._projectionUtils.latLngToSvgPoint(e[0]),r=t._projectionUtils.latLngToSvgPoint(e[1]);return p.transformText(n,r,Qt)})).text((function(e){return t._helper.formatLength(t._helper.computeLengthBetween(e[0],e[1]))})),n.exit().remove()}},{key:"_updateCirclePosition",value:function(t,e){var n=this._svgObjs.select("circle[id=circle-".concat(this._curGeomIndex,"]"));if(0!==n.size()){var r=Number(n.attr("cx")),i=Number(n.attr("cy")),o=this.geometry().svgRadius;switch(t){case 0:r=e.x,i=e.y}n.attr("cx",r).attr("cy",i).attr("r",o)}}},{key:"_updateCircleNode",value:function(t,e){var n=this._projectionUtils.svgPointToLatLng([e.x,e.y]);switch(t){case 0:var r=this.geometry().svgRadius,i=[e.x+r,e.y];this.geometry().setCenter(n),this.geometry().setEndPoint(this._projectionUtils.svgPointToLatLng(i));break;case 1:case 2:case 3:case 4:var o=this._projectionUtils.latLngToSvgPoint(this.geometry().center),a=Math.abs(o[0]-e.x),s=Math.abs(o[1]-e.y),c=Math.sqrt(Math.pow(a,2)+Math.pow(s,2));this.geometry().setEndPoint(this._projectionUtils.svgPointToLatLng([o[0],o[1]+c]))}}},{key:"drawRectangle",value:function(){var t=this;"rect"!==this._drawing&&(this.geometries().forEach((function(e,n){e.isValid||t.removeGeometry(n)})),this.addGeometry(new _),this._draw(),this._drawing="rect")}},{key:"_updateRectPosition",value:function(t,e){var n=this._svgObjs.select("rect[id=rect-".concat(this._curGeomIndex,"]"));if(0!==n.size()){var r=Number(n.attr("x")),i=Number(n.attr("y")),o=Number(n.attr("width")),a=Number(n.attr("height")),s=[r+o,i+a];switch(t){case 0:var c=[r+o/2,i+a/2];r+=e.x-c[0],i+=e.y-c[1];break;case 1:r=e.x,i=e.y,o=Math.abs(r-s[0]),a=Math.abs(i-s[1]);break;case 2:i=e.y,o=Math.abs(e.x-r),a=Math.abs(s[1]-i);break;case 3:o=Math.abs(e.x-r),a=Math.abs(e.y-i);break;case 4:r=e.x,o=Math.abs(r-s[0]),a=Math.abs(i-e.y)}n.attr("x",r).attr("y",i).attr("width",o).attr("height",a)}}},{key:"_updateRectNode",value:function(t,e){var n=this._svgObjs.select("rect[id=rect-".concat(this._curGeomIndex,"]"));if(0!==n.size()){var r=this._projectionUtils.svgPointToLatLng([e.x,e.y]),i=this.geometry().coordinates;switch(t){case 0:var o=Number(n.attr("x")),a=Number(n.attr("y")),s=Number(n.attr("width")),c=Number(n.attr("height")),u=[o+s/2,a+c/2],l=(o+=e.x-u[0])+s,h=(a+=e.y-u[1])+c;this.geometry().setFirstPoint(this._projectionUtils.svgPointToLatLng([o,a])),this.geometry().setEndPoint(this._projectionUtils.svgPointToLatLng([l,h]));break;case 1:this.geometry().setFirstPoint(r),this.geometry().setEndPoint(i[2]);break;case 2:this.geometry().setFirstPoint([i[0][0],r[1]]),this.geometry().setEndPoint([r[0],i[2][1]]);break;case 3:this.geometry().setEndPoint(r);break;case 4:this.geometry().setFirstPoint([r[0],i[0][1]]),this.geometry().setEndPoint([i[2][0],r[1]])}}}},{key:"_updateRectangle",value:function(){var t=this,e=this._svgObjs.selectAll("rect").data(this.rects).attr("class","base-line").attr("x",(function(e){return t._projectionUtils.latLngToSvgPoint(e.geom.coordinates[0])[0]})).attr("y",(function(e){return t._projectionUtils.latLngToSvgPoint(e.geom.coordinates[0])[1]})).attr("width",(function(e){var n=e.geom.coordinates[0],r=e.geom.coordinates[2],i=0;if(n&&n.length&&r&&r.length){var o=t._projectionUtils.latLngToSvgPoint(n),a=t._projectionUtils.latLngToSvgPoint(r);i=Number(a[0])-Number(o[0])}return i})).attr("height",(function(e){var n=e.geom.coordinates[0],r=e.geom.coordinates[2],i=0;if(n&&n.length&&r&&r.length){var o=t._projectionUtils.latLngToSvgPoint(n),a=t._projectionUtils.latLngToSvgPoint(r);i=Number(a[1])-Number(o[1])}return i}));if(this.geometry()instanceof _){var n=this.geometry().coordinates[0],r=this.geometry().coordinates[2];if(n&&n.length&&r&&r.length){var i=this._projectionUtils.latLngToSvgPoint(n),o=this._projectionUtils.latLngToSvgPoint(r),a=Number(o[0])-Number(i[0]),s=Number(o[1])-Number(i[1]);e.enter().append("rect").attr("id","rect-".concat(this._curGeomIndex)).attr("class","base-line").attr("x",i[0]).attr("y",i[1]).attr("width",a).attr("height",s)}}this._updateSegmentTextRect()}},{key:"_updateSegmentTextRect",value:function(){var t=this,e=this._segmentText.selectAll("g[id^=g-rect-]").data(this.rects);e.enter().append("g").attr("id",(function(t){return"g-rect-".concat(t.id)}));var n=e.selectAll("text").data((function(e){return t.geometry(e.id).lines})).attr("class","segment-measure-text").attr("text-anchor","middle").attr("dominant-baseline","text-before-edge").attr("transform",(function(e){var n=t._projectionUtils.latLngToSvgPoint(e[0]),r=t._projectionUtils.latLngToSvgPoint(e[1]);return p.transformText(n,r,Qt)})).text((function(e){return t._helper.formatLength(t._helper.computeLengthBetween(e[0],e[1]))}));n.enter().append("text").attr("class","segment-measure-text").attr("text-anchor","middle").attr("dominant-baseline","text-before-edge").attr("transform",(function(e){var n=t._projectionUtils.latLngToSvgPoint(e[0]),r=t._projectionUtils.latLngToSvgPoint(e[1]);return p.transformText(n,r,Qt)})).text((function(e){return t._helper.formatLength(t._helper.computeLengthBetween(e[0],e[1]))})),n.exit().remove()}},{key:"drawEnd",value:function(t){var e=this;(this._drawing||t)&&(this._drawing=null,this._overlay.draw(),this._dragged=!1,this._svgOverlayEvent=this._svgOverlay.on("click",(function(t){if(t.target.id.match(/(rect|polygon|circle)\-(\d+)/g)){var n=t.target.id.match(/(rect|polygon|circle)\-(\d+)/)[2];e._curGeomIndex=Number(n)}else e._curGeomIndex=0;e._overlay.draw(),e._dragged=!1})))}}]),a}(Yt)}));
